# üìö –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ 3 –†–µ–∂–∏–º–∞–º –†–∞–±–æ—Ç—ã

## üéØ –û–±–∑–æ—Ä –†–µ–∂–∏–º–æ–≤

```
MODE 1: PARSING ONLY ‚úÖ
‚îú‚îÄ –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–∏–Ω–≥ Habr
‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
‚îî‚îÄ status: "pending"

MODE 2: AI PROCESSING ü§ñ
‚îú‚îÄ –ë–µ—Ä—ë—Ç —Å—Ç–∞—Ç—å–∏ —Å–æ status="pending"
‚îú‚îÄ AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Ollama)
‚îÇ   ‚îú‚îÄ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–Ω–æ–≤–æ—Å—Ç—å/—Å—Ç–∞—Ç—å—è)
‚îÇ   ‚îú‚îÄ –û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (0-10)
‚îÇ   ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∑–µ—Ä–∞
‚îÇ   ‚îî‚îÄ –£–ª—É—á—à–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
‚îî‚îÄ status: "processed"

MODE 3: FULL PIPELINE üöÄ
‚îú‚îÄ –ü–∞—Ä—Å–∏–Ω–≥
‚îú‚îÄ Qdrant –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
‚îú‚îÄ AI –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
‚îú‚îÄ –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Qdrant
‚îî‚îÄ status: "completed"
```

---

## üìñ MODE 1: –¢–æ–ª—å–∫–æ –ü–∞—Ä—Å–∏–Ω–≥

### –ó–∞–ø—É—Å–∫:

```bash
# –í Docker
docker-compose exec api python run_scraper.py 20 "python,devops"

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
python run_scraper.py 20 "python,devops"
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ 20 —Å—Ç–∞—Ç–µ–π —Å–ø–∞—Ä—Å–µ–Ω–æ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ PostgreSQL
- ‚è≥ status = "pending"
- ‚è≥ –ù–µ—Ç AI –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚è≥ –ù–µ—Ç –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ Qdrant

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ë—ã—Å—Ç—Ä—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞
- –°–±–æ—Ä –∞—Ä—Ö–∏–≤–∞ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## ü§ñ MODE 2: AI –û–±—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫:

```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å 10 –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
docker-compose exec api python process_articles.py 10

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ pending
docker-compose exec api python process_articles.py 1000
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

1. **Classifier Agent** ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç is_news
   ```
   –ù–û–í–û–°–¢–¨: "–†–µ–ª–∏–∑ Python 3.12", "Apple –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞..."
   –°–¢–ê–¢–¨–Ø: "–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Docker", "–¢—É—Ç–æ—Ä–∏–∞–ª –ø–æ React"
   ```

2. **Relevance Agent** ‚Üí –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç relevance_score (0-10)
   ```
   10: –ü—Ä–æ—Ä—ã–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, major —Ä–µ–ª–∏–∑—ã
   7-9: –ù–æ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã, –ø–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
   4-6: –û–±—ã—á–Ω—ã–µ —Ç—É—Ç–æ—Ä–∏–∞–ª—ã
   1-3: –ë–∞–∑–æ–≤—ã–µ —Ç–µ–º—ã
   0: –ù–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ
   ```

3. **Summarizer Agent** ‚Üí —Å–æ–∑–¥–∞—ë—Ç editorial_teaser
   ```
   –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö
   ```

4. **Rewriter Agent** ‚Üí —É–ª—É—á—à–∞–µ—Ç editorial_title
   ```
   –ë—ã–ª–æ: "–°—Ç–∞—Ç—å—è –ø—Ä–æ Docker"
   –°—Ç–∞–ª–æ: "Docker –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö: –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ"
   ```

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ is_news –∑–∞–ø–æ–ª–Ω–µ–Ω
- ‚úÖ relevance_score (0-10)
- ‚úÖ editorial_teaser
- ‚úÖ editorial_title
- ‚úÖ status = "processed"

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–∂–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
- –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
- –†–∞–∑–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–∞—Ä—Å–∏–Ω–≥ + AI)

---

## üöÄ MODE 3: –ü–æ–ª–Ω—ã–π –ü–∞–π–ø–ª–∞–π–Ω

### –ó–∞–ø—É—Å–∫:

```bash
# 20 —Å—Ç–∞—Ç–µ–π —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
docker-compose exec api python run_full_pipeline.py 20 "python,devops"

# 50 —Å—Ç–∞—Ç–µ–π, –≤—Å–µ —Ö–∞–±—ã
docker-compose exec api python run_full_pipeline.py 50
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

```
–°—Ç–∞—Ç—å—è ‚Üí Qdrant Check ‚Üí AI Processing ‚Üí PostgreSQL + Qdrant
         (–¥—É–±–ª–∏–∫–∞—Ç?)     (4 –∞–≥–µ–Ω—Ç–∞)     (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
```

**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**

1. **–ü–∞—Ä—Å–∏–Ω–≥** - —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ —Å Habr
2. **Qdrant –ø—Ä–æ–≤–µ—Ä–∫–∞** - —Å—Ö–æ–∂–µ—Å—Ç—å > 90% = –¥—É–±–ª–∏–∫–∞—Ç
3. **PostgreSQL –ø—Ä–æ–≤–µ—Ä–∫–∞** - exists_by_url
4. **AI –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—Å–µ 4 –∞–≥–µ–Ω—Ç–∞
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - PostgreSQL + Qdrant –≤–µ–∫—Ç–æ—Ä

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ AI –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≥–æ—Ç–æ–≤
- ‚úÖ status = "completed"

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- Production —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

---

## üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –î–∞–Ω–Ω—ã—Ö

### 1. Swagger UI
```
http://localhost:8000/docs
```
‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π API  
‚úÖ –§–∏–ª—å—Ç—Ä—ã  
‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è  

### 2. API Endpoints

```bash
# –í—Å–µ —Å—Ç–∞—Ç—å–∏
curl http://localhost:8000/api/v1/articles/

# –¢–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ AI
curl http://localhost:8000/api/v1/articles/?status=processed

# –¢–æ–ª—å–∫–æ –Ω–æ–≤–æ—Å—Ç–∏
curl http://localhost:8000/api/v1/articles/?is_news=true

# –¢–æ–ø –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
curl http://localhost:8000/api/v1/articles/?limit=10
# (–¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –≤ API –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

### 3. PostgreSQL

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
docker-compose exec postgres psql -U newsaggregator -d news_aggregator

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
  status,
  COUNT(*) as count,
  AVG(relevance_score) as avg_score
FROM articles 
GROUP BY status;

# –¢–æ–ø —Å—Ç–∞—Ç–µ–π
SELECT title, relevance_score, is_news 
FROM articles 
WHERE relevance_score >= 8
ORDER BY relevance_score DESC
LIMIT 10;
```

---

## üîß –¢—Ä–µ–±—É–µ–º—ã–µ –ú–æ–¥–µ–ª–∏ Ollama

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π:

```bash
# Mistral (–±—ã—Å—Ç—Ä–∞—è, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è)
docker-compose exec ollama ollama pull mistral

# Llama 3 (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è)
docker-compose exec ollama ollama pull llama3

# DeepSeek R1 20B (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞)
docker-compose exec ollama ollama pull deepseek-r1:20b
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
docker-compose exec ollama ollama list
```

---

## üéì –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ë—ã—Å—Ç—Ä—ã–π –°–±–æ—Ä + –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Ç—Ä–æ–º: —Å–æ–±—Ä–∞—Ç—å 100 —Å—Ç–∞—Ç–µ–π (–±—ã—Å—Ç—Ä–æ)
docker-compose exec api python run_scraper.py 100

# –í–µ—á–µ—Ä–æ–º: –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ AI (–º–µ–¥–ª–µ–Ω–Ω–æ)
docker-compose exec api python process_articles.py 100
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª–Ω—ã–π Production Pipeline

```bash
# –†–∞–∑ –≤ —á–∞—Å —á–µ—Ä–µ–∑ cron
0 * * * * cd /path && docker-compose exec -T api python run_full_pipeline.py 20
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å AI

```bash
# 1. –°–æ–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä
docker-compose exec api python run_scraper.py 10

# 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
docker-compose exec api python process_articles.py 5

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
curl http://localhost:8000/api/v1/articles/?limit=5
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –†–µ–∂–∏–º | –°–∫–æ—Ä–æ—Å—Ç—å | –†–µ—Å—É—Ä—Å—ã | –ö–∞—á–µ—Å—Ç–≤–æ |
|-------|----------|---------|----------|
| MODE 1 | ‚ö°‚ö°‚ö° –ë—ã—Å—Ç—Ä–æ | CPU | - |
| MODE 2 | ‚ö° –ú–µ–¥–ª–µ–Ω–Ω–æ | GPU/CPU + RAM | ‚≠ê‚≠ê‚≠ê |
| MODE 3 | ‚ö° –ú–µ–¥–ª–µ–Ω–Ω–æ | GPU/CPU + RAM | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |

**–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è:**
- MODE 1: ~1 —Å–µ–∫/—Å—Ç–∞—Ç—å—è
- MODE 2: ~10-30 —Å–µ–∫/—Å—Ç–∞—Ç—å—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏)
- MODE 3: ~15-35 —Å–µ–∫/—Å—Ç–∞—Ç—å—è

---

## ‚ùì FAQ

**Q: –ö–∞–∫–æ–π —Ä–µ–∂–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**  
A: MODE 3 –¥–ª—è production, MODE 1+2 –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

**Q: –ù—É–∂–µ–Ω –ª–∏ GPU?**  
A: –ù–µ—Ç, –Ω–æ —Å GPU –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ (Ollama –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CUDA)

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã?**  
A: –î–∞, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ `src/application/ai_services/agents/`

**Q: Qdrant –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω?**  
A: –ù–µ—Ç, MODE 2 —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–≥–æ

**Q: –ö–∞–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?**  
A: –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f api`
